@model HomeViewModel

@{
    ViewData["Title"] = "Home Page";
}

<div style="text-align:right">
    <input id="getLatest" type="button" class="btn btn-success" value="Get Latest" />
</div>
<div class="latestNews"></div>
<div>
    <h2 id="categoryHeading">Lifestyle News</h2>
    @foreach (var category in Model.Categories)
    {
        <h3 id="catName">@category.Name</h3>

        @foreach (var article in Model.Articles.Where(a => a.Category == category.Name).OrderByDescending(c => c.TimeCreated).Take(3))
        {
        <div class="article">
            <h5 style="font-size:24px;" class="hvr-float">@Html.ActionLink(article.Title, "Details", "Article", new { id = article.Id }, null)</h5>
            <h6 id="articleAuthorBottm" style="margin:0">By: @article.Author</h6>
        </div>
        }
    }
</div>

<script>
    $(document).ready(() => { 
        $('#getLatest').on('click', () => {
            var url = 'https://newsapi.org/v2/top-headlines?' +
                'country=bg&' +
                'apiKey=247a0ba6d5a3416ba6e0075391893d63';
            var req = new Request(url);
            fetch(req)
                .then(function (response) {
                    response.json().then((data) => {
                        let articles = data.articles;

                        for (let article of articles) {
                            console.log(article);
                            if (article.title != null &&
                                article.description != null &&
                                article.author != null &&
                                article.urlToImage != null &&
                                article.url != null) {
                                $(".latestNews").append(`
                                                    <div class="article">
                                                        <a style="font-size:24px;text-decoration:none" href="${article.url}" class="hvr-float" target="_blank">${article.title})</a>
                                                        <img src="${article.urlToImage}" style="width:300px;display:block"/>
                                                        <p class="description">${article.description}</p>
                                                        <label class="author" style="margin:0">Author: ${article.author}</label>
                                                        <label class="source">Source site: ${article.source.name}</label>
                                                        <label class="publishedDate">Published Date: ${new Date(article.publishedAt).toUTCString()}</label>
                                                    </div>
                                                 `)
                            }
                        }
                    });
                })
        })
    })
</script>